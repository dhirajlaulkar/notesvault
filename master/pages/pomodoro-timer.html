<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="NotesVault Pomodoro Timer - Boost your productivity with focused study sessions"
    />
    <title>Pomodoro Timer - NotesVault</title>

    <!-- Favicon -->
    <link
      rel="icon"
      href="../assets/index/images/favicon.png"
      type="image/x-icon"
    />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <!-- CSS -->
    <link rel="stylesheet" href="../styling/pomodoro-timer.css" />
    <link rel="stylesheet" href="../styling/base.css" />
    <link rel="stylesheet" href="../styling/variables.css" />
  </head>

  <body>
    <!-- Header -->
    <div id="header-placeholder"></div>

    <!-- Main Content -->
    <main id="main-content">
      <section class="pomodoro-section">
        <!-- Hero Section -->
        <div class="pomodoro-hero">
          <div class="container">
            <h1>Pomodoro Timer</h1>
            <p class="subtitle">
              Enhance your focus and productivity with timed study sessions
            </p>
          </div>
        </div>

        <div class="pomodoro-container">
          <div class="timer-display">
            <div class="timer-circle" id="timer-circle">
              <div class="time-left" id="time-display">25:00</div>
            </div>
            <div class="timer-status" id="timer-status">Ready To Focus</div>

            <div class="timer-controls">
              <button class="timer-btn btn-start" id="start-btn">
                <i class="fas fa-play"></i>Start
              </button>
              <button class="timer-btn btn-pause" id="pause-btn" disabled>
                <i class="fas fa-pause"></i>Pause
              </button>
              <button class="timer-btn btn-reset" id="reset-btn" disabled>
                <i class="fas fa-redo"></i>Reset
              </button>
            </div>

            <div class="timer-settings">
              <div class="time-setting">
                <label for="focus-time">Focus Time (Minutes)</label>
                <div class="time-input">
                  <button id="focus-decrement">
                    <i class="fas fa-minus"></i>
                  </button>
                  <input
                    type="number"
                    id="focus-time"
                    min="1"
                    max="60"
                    value="25"
                  />
                  <button id="focus-increment">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
              </div>

              <div class="time-setting">
                <label for="break-time">Break Time (Minutes)</label>
                <div class="time-input">
                  <button id="break-decrement">
                    <i class="fas fa-minus"></i>
                  </button>
                  <input
                    type="number"
                    id="break-time"
                    min="1"
                    max="30"
                    value="5"
                  />
                  <button id="break-increment">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
              </div>
            </div>

            <div class="session-stats">
              <div class="stat-item">
                <div class="stat-value" id="sessions-completed">0</div>
                <div class="stat-label">Sessions</div>
              </div>

              <div class="stat-item">
                <div class="stat-value" id="total-focus-time">0</div>
                <div class="stat-label">Focus Minutes</div>
              </div>

              <div class="stat-item">
                <div class="stat-value" id="cycles-completed">0</div>
                <div class="stat-label">Cycles</div>
              </div>
            </div>

            <div class="session-completed" id="session-complete-alert">
              <i class="fas fa-check-circle"></i>
              <span id="complete-message"
                >Focus Session Completed! Time For A Break.</span
              >
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <div id="footer-placeholder"></div>

    <!-- JavaScript -->
    <script src="../scripts/script.js" defer></script>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // Timer Elements
        const timeDisplay = document.getElementById('time-display')
        const timerStatus = document.getElementById('timer-status')
        const startBtn = document.getElementById('start-btn')
        const pauseBtn = document.getElementById('pause-btn')
        const resetBtn = document.getElementById('reset-btn')
        const timerCircle = document.getElementById('timer-circle')

        // Settings Elements
        const focusTimeInput = document.getElementById('focus-time')
        const breakTimeInput = document.getElementById('break-time')
        const focusDecrement = document.getElementById('focus-decrement')
        const focusIncrement = document.getElementById('focus-increment')
        const breakDecrement = document.getElementById('break-decrement')
        const breakIncrement = document.getElementById('break-increment')

        // Stats Elements
        const sessionsCompleted = document.getElementById('sessions-completed')
        const totalFocusTime = document.getElementById('total-focus-time')
        const cyclesCompleted = document.getElementById('cycles-completed')
        const sessionCompleteAlert = document.getElementById(
          'session-complete-alert'
        )
        const completeMessage = document.getElementById('complete-message')

        // Timer Variables
        let timer
        let isRunning = false
        let isFocusTime = true
        let timeLeft = parseInt(focusTimeInput.value) * 60
        let totalTime = timeLeft
        let sessionCount = 0
        let focusMinutes = 0
        let cycleCount = 0

        // Update Timer Display
        function updateDisplay() {
          const minutes = Math.floor(timeLeft / 60)
          const seconds = timeLeft % 60
          timeDisplay.textContent = `${minutes
            .toString()
            .padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`

          // Update Progress Circle
          const progress = ((totalTime - timeLeft) / totalTime) * 100
          timerCircle.style.background = `conic-gradient(var(${
            isFocusTime ? '--primary-500' : '--accent-500'
          }) ${progress}%, var(--gray-200) 0%)`
        }

        // Start Timer
        function startTimer() {
          if (!isRunning) {
            isRunning = true
            startBtn.disabled = true
            pauseBtn.disabled = false
            resetBtn.disabled = false
            focusTimeInput.disabled = true
            breakTimeInput.disabled = true

            timer = setInterval(() => {
              timeLeft--
              updateDisplay()

              if (timeLeft === 0) {
                clearInterval(timer)
                isRunning = false

                if (isFocusTime) {
                  // Focus Session Completed
                  sessionCount++
                  focusMinutes += parseInt(focusTimeInput.value)
                  sessionsCompleted.textContent = sessionCount
                  totalFocusTime.textContent = focusMinutes

                  // Completion Alert
                  completeMessage.textContent =
                    'Focus Session Completed! Time For A Break.'
                  sessionCompleteAlert.style.display = 'block'

                  // Switch To Break Time
                  isFocusTime = false
                  timeLeft = parseInt(breakTimeInput.value) * 60
                  totalTime = timeLeft
                  timerStatus.textContent = 'Break Time'

                  // Play Notification Sound
                  playNotificationSound()
                } else {
                  // Break Completed
                  cycleCount++
                  cyclesCompleted.textContent = cycleCount

                  // Show Completion Alert
                  completeMessage.textContent =
                    'Break Completed! Ready For Another Focus Session?'
                  sessionCompleteAlert.style.display = 'block'

                  // Switch To Focus Time
                  isFocusTime = true
                  timeLeft = parseInt(focusTimeInput.value) * 60
                  totalTime = timeLeft
                  timerStatus.textContent = 'Focus Time'

                  // Play Notification Sound
                  playNotificationSound()
                }

                updateDisplay()
                startBtn.disabled = false
                pauseBtn.disabled = true
              }
            }, 1000)
          }
        }

        // Pause Timer
        function pauseTimer() {
          if (isRunning) {
            clearInterval(timer)
            isRunning = false
            startBtn.disabled = false
            pauseBtn.disabled = true
            timerStatus.textContent = 'Paused'
          }
        }

        // Reset Timer
        function resetTimer() {
          clearInterval(timer)
          isRunning = false
          isFocusTime = true
          timeLeft = parseInt(focusTimeInput.value) * 60
          totalTime = timeLeft
          timerStatus.textContent = 'Ready To Focus'
          startBtn.disabled = false
          pauseBtn.disabled = true
          resetBtn.disabled = true
          focusTimeInput.disabled = false
          breakTimeInput.disabled = false
          sessionCompleteAlert.style.display = 'none'
          updateDisplay()
        }

        // Play Notification Sound
        function playNotificationSound() {
          // Notification Sound (Web Audio API)
          try {
            const audioContext = new (window.AudioContext ||
              window.webkitAudioContext)()
            const oscillator = audioContext.createOscillator()
            const gainNode = audioContext.createGain()

            oscillator.connect(gainNode)
            gainNode.connect(audioContext.destination)

            oscillator.frequency.value = 800
            gainNode.gain.value = 0.3

            oscillator.start()
            gainNode.gain.exponentialRampToValueAtTime(
              0.00001,
              audioContext.currentTime + 1
            )

            setTimeout(() => {
              oscillator.stop()
            }, 1000)
          } catch (e) {
            console.log('Web Audio API not supported in this browser')
          }
        }

        // Update Timer When Settings Change
        function updateTimerFromSettings() {
          if (!isRunning) {
            timeLeft = parseInt(focusTimeInput.value) * 60
            totalTime = timeLeft
            updateDisplay()
          }
        }

        // Event Listeners
        startBtn.addEventListener('click', startTimer)
        pauseBtn.addEventListener('click', pauseTimer)
        resetBtn.addEventListener('click', resetTimer)

        // Settings Controls
        focusDecrement.addEventListener('click', () => {
          if (focusTimeInput.value > 1) {
            focusTimeInput.value = parseInt(focusTimeInput.value) - 1
            updateTimerFromSettings()
          }
        })

        focusIncrement.addEventListener('click', () => {
          if (focusTimeInput.value < 60) {
            focusTimeInput.value = parseInt(focusTimeInput.value) + 1
            updateTimerFromSettings()
          }
        })

        breakDecrement.addEventListener('click', () => {
          if (breakTimeInput.value > 1) {
            breakTimeInput.value = parseInt(breakTimeInput.value) - 1
          }
        })

        breakIncrement.addEventListener('click', () => {
          if (breakTimeInput.value < 30) {
            breakTimeInput.value = parseInt(breakTimeInput.value) + 1
          }
        })

        focusTimeInput.addEventListener('change', () => {
          if (focusTimeInput.value < 1) focusTimeInput.value = 1
          if (focusTimeInput.value > 60) focusTimeInput.value = 60
          updateTimerFromSettings()
        })

        breakTimeInput.addEventListener('change', () => {
          if (breakTimeInput.value < 1) breakTimeInput.value = 1
          if (breakTimeInput.value > 30) breakTimeInput.value = 30
        })

        // Initialize Display
        updateDisplay()
      })
    </script>
  </body>
</html>
